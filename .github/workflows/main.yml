name: CF-Active

on:
  schedule:
    - cron: "30 22 * * *"
  workflow_dispatch:

jobs:
  alive:
    runs-on: ubuntu-latest

    steps:
      - name: 安装 Cloud Foundry CLI
        run: |
          wget -q -O cf-cli.deb "https://packages.cloudfoundry.org/stable?release=debian64&source=github"
          sudo dpkg -i cf-cli.deb

      - name: 登录 CF
        env:
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.PASSWORD }}
          api:      ${{ secrets.API }}
          org:      ${{ secrets.ORG }}
          space:    ${{ secrets.SPACE }}
        run: |
          cf api $api
          cf login -u "$username" -p "$password" -o "$org" -s "$space"

      - name: 启动应用
        env:
          app: ${{ secrets.APP }}
        run: |
          cf restart "$app"
